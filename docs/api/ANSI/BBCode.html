<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: ANSI::BBCode</title>

  
    <link rel="SHORTCUT ICON" href="../assets/icon/module.png">
  

  <link type="text/css" rel="stylesheet" href="../assets/rdoc.css" media="screen" />
  <link type="text/css" rel="stylesheet" href="../assets/highlight/styles/github.css" title="GitHub" />

  <script type="text/javascript" charset="utf-8" src="../assets/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/highlight/highlight.pack.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/quicksearch.js"></script>
  <script type="text/javascript" charset="utf-8" src="../assets/main.js"></script>

  <script type="text/javascript">
    $(document).ready( function() {
      $('#documentation pre').wrapInner('<code></code>');
      hljs.tabReplace = '    ';
      hljs.initHighlightingOnLoad('ruby');

	    hookSourceViews();
	    hookDebuggingToggle();
	    hookQuickSearch();
	    highlightLocationTarget();

	    $('ul.link-list a').bind( "click", highlightClickTarget );
    });
  </script>
</head>
<body class="module">
<div id="main">

  <div class="head">
    <h1>
      
        <img src="../assets/icon/module.png" align="absmiddle">&nbsp;
      
      <a href="../index.html">&quot;ANSI&quot;</a>&nbsp;
      <a href="/">ANSI::BBCode</a>
    </h1>
  </div>

  <div id="metadata">
    <div id="project-metadata">

      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li class="file"><a href="../lib/ansi/bbcode_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/ansi/bbcode.rb">lib/ansi/bbcode.rb</a></li>
          
          </ul>
        </div>
      </div>

      <!-- What about Git info, or Hg info? This seems almost silly, albeit kind of cool. -->
      <!-- TODO: generalize this for all SCMs -->

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
            
            <li class="singleton">
              <a href="#method-c-ansi">::ansi</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-ansi_to_bbcode">::ansi_to_bbcode</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-ansi_to_html">::ansi_to_html</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-bbcode_to_ansi">::bbcode_to_ansi</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-bbcode_to_html">::bbcode_to_html</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-html_to_ansi">::html_to_ansi</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-html_to_bbcode">::html_to_bbcode</a>
            </li>
          
            
            <li class="singleton">
              <a href="#method-c-strip_bbcode">::strip_bbcode</a>
            </li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Information</h3>
        <ul>
        
          <li class="file"><a href="../PROFILE.html">PROFILE</a></li>
        
          <li class="file"><a href="../HISTORY_rdoc.html">HISTORY.rdoc</a></li>
        
          <li class="file"><a href="../LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="../VERSION.html">VERSION</a></li>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
          <li class="file"><a href="../NOTICE_rdoc.html">NOTICE.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../assets/icon/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <!-- classpage.html : classes -->
        <ul class="link-list">
        
          <li class="module"><a href="../ANSI.html">ANSI</a></li>
        
          <li class="module"><a href="../ANSI/BBCode.html">ANSI::BBCode</a></li>
        
          <li class="module"><a href="../ANSI/Code.html">ANSI::Code</a></li>
        
          <li class="class"><a href="../ANSI/Columns.html">ANSI::Columns</a></li>
        
          <li class="class"><a href="../ANSI/Diff.html">ANSI::Diff</a></li>
        
          <li class="class"><a href="../ANSI/Logger.html">ANSI::Logger</a></li>
        
          <li class="module"><a href="../ANSI/Mixin.html">ANSI::Mixin</a></li>
        
          <li class="class"><a href="../ANSI/ProgressBar.html">ANSI::ProgressBar</a></li>
        
          <li class="class"><a href="../ANSI/String.html">ANSI::String</a></li>
        
          <li class="class"><a href="../ANSI/Table.html">ANSI::Table</a></li>
        
          <li class="module"><a href="../ANSI/Terminal.html">ANSI::Terminal</a></li>
        
          <li class="class"><a href="../String.html">String</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>
    </div>

    <div id="validator-badges">
      
      <div style="float: right; margin-right: 5px;">
        <a href="http://validator.w3.org/check/referer"><img src="../assets/icon/check.png" alt="[Validate]" height="16" width="16" /></a>
      </div>
      Generated with <a href="http://rubyworks.github.com/newfish">Newfish</a> 0.2.0
      <br/><br/>
    </div>
  </div>

  <div id="documentation">

    <div id="description">
      

      
<h1><a href="BBCode.html">BBCode</a></h1>

<p>The <a href="BBCode.html">BBCode</a> module helps ease the separation of
core and frontend with the core (or submodules) being still able to say,
what colors shall be used in it’s responses. This is achieved by encoding
formatting information using the <a href="BBCode.html">BBCode</a> tokens.
This enables you to “pipe” layout information such as colors, style,
fonttype, size and alignment through the core to the frontend.</p>

<p>Additionally it converts markups/codes between <a
href="../ANSI.html">ANSI</a>, HTML and <a href="BBCode.html">BBCode</a>
almost freely ;)</p>

<h2>Usage</h2>

<pre># Converting a bbcode string to ANSI and XHTML

str = &quot;this is [COLOR=red]red[/COLOR], this is [B]bold[/B]&quot;
print( BBCode.bbcode_to_ansi(str) )
print( BBCode.bbcode_to_html(str) )</pre>

    </div>

    <!-- Constants -->
    
    <div id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt><a name="ANSINAME2CODE">ANSINAME2CODE</a></dt>
        
        <dd class="description"><p>ANSIname =&gt; ANSIcode LUT</p></dd>
        
      
        <dt><a name="BBCOLOR2ANSI">BBCOLOR2ANSI</a></dt>
        
        <dd class="description"><p>BBColor =&gt; ANSIname LUT</p></dd>
        
      
        <dt><a name="ANSINAME2BBCODE">ANSINAME2BBCODE</a></dt>
        
        <dd class="description"><p>ANSInames =&gt; <a href="BBCode.html">BBCode</a> LUT</p></dd>
        
      
      </dl>
    </div>
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-class-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="ansi-method" class="method-detail ">
        <a name="method-c-ansi"></a>

        <div class="method-heading">
        
          <span class="method-name">ansi</span><span
            class="method-args">(colorname)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Returns the <a href="../ANSI.html">ANSI</a> sequence for given color, if
existant</p>
          

          
          <div class="method-source-code"
            id="ansi-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi</span>(<span class="ruby-identifier">colorname</span>)
    <span class="ruby-identifier">colorname</span>.<span class="ruby-identifier">strip!</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">ANSINAME2CODE</span>[ <span class="ruby-identifier">colorname</span>.<span class="ruby-identifier">downcase</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="ansi_to_bbcode-method" class="method-detail ">
        <a name="method-c-ansi_to_bbcode"></a>

        <div class="method-heading">
        
          <span class="method-name">ansi_to_bbcode</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Returns the string with all ansi escape sequences converted to BBCodes</p>
          

          
          <div class="method-source-code"
            id="ansi_to_bbcode-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 103</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_bbcode</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">tagstack</span> = []

    <span class="ruby-comment">## Iterate over input lines</span>
    <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
        <span class="ruby-comment">## Iterate over found ansi sequences</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\e\[[0-9;]+m/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">seq</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">ansiname</span> = <span class="ruby-constant">ANSINAME2CODE</span>.<span class="ruby-identifier">invert</span>[<span class="ruby-node">&quot;#{seq}&quot;</span>]

            <span class="ruby-comment">## Pop last tag and form closing tag</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">ansiname</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;reset&quot;</span>
                <span class="ruby-identifier">lasttag</span> = <span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">pop</span>
                <span class="ruby-identifier">bbname</span> = <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">lasttag</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;=&quot;</span>)[<span class="ruby-value">0</span>] )

            <span class="ruby-comment">## Get corresponding BBCode tag + Push to stack</span>
            <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">bbname</span>   = <span class="ruby-constant">ANSINAME2BBCODE</span>[<span class="ruby-identifier">ansiname</span>]
                <span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">bbname</span>)
            <span class="ruby-keyword">end</span>

            <span class="ruby-comment">## Replace ansi sequence by BBCode tag</span>
            <span class="ruby-identifier">replace</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;[%s]&quot;</span>, <span class="ruby-identifier">bbname</span>)
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-identifier">seq</span>, <span class="ruby-identifier">replace</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">## Append converted line</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%s\n&quot;</span>, <span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">end</span>


    <span class="ruby-comment">## Some tags are unclosed</span>
    <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;[/%s]&quot;</span>, <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tagstack</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;=&quot;</span>)[<span class="ruby-value">0</span>])  )
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="ansi_to_html-method" class="method-detail ">
        <a name="method-c-ansi_to_html"></a>

        <div class="method-heading">
        
          <span class="method-name">ansi_to_html</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Converts a <a href="../ANSI.html">ANSI</a> string to one with HTML markup.
Returns the string with <a href="../ANSI.html">ANSI</a> code sequences
converted to XHTML markup.</p>
          

          
          <div class="method-source-code"
            id="ansi_to_html-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_html</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-identifier">bbcoded</span> = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">ansi_to_bbcode</span>(<span class="ruby-identifier">string</span> )
    <span class="ruby-identifier">htmled</span>  = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_html</span>(<span class="ruby-identifier">bbcoded</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">htmled</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="bbcode_to_ansi-method" class="method-detail ">
        <a name="method-c-bbcode_to_ansi"></a>

        <div class="method-heading">
        
          <span class="method-name">bbcode_to_ansi</span><span
            class="method-args">(string, usecolors = true)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Converts a <a href="BBCode.html">BBCode</a> string to one with <a
href="../ANSI.html">ANSI</a> sequences. Returns the string with all
formatting instructions in BBCodes converted to <a
href="../ANSI.html">ANSI</a> code sequences / aligned with spaces to
specified width.</p>
          

          
          <div class="method-source-code"
            id="bbcode_to_ansi-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_ansi</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">usecolors</span> = <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-keyword">return</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">strip_bbcode</span>(<span class="ruby-identifier">string</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">usecolors</span>

    <span class="ruby-comment">## Iterate over lines</span>
    <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>

        <span class="ruby-comment">## TODO: stacking? other styles!</span>
        <span class="ruby-constant">ANSINAME2BBCODE</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[#{val}\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-identifier">key</span>])
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[\/#{val}\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-string">&quot;reset&quot;</span>])
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">## Fonttypes and sizes not available</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[SIZE=\d\]/</span>, <span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/SIZE\]/</span>, <span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[FONT=[^\]]*\]/</span>, <span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/FONT\]/</span>, <span class="ruby-string">&quot;&quot;</span>)

        <span class="ruby-comment">## Color-mapping</span>
        <span class="ruby-identifier">colors</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\[COLOR=(.*?)\]/</span>)
        <span class="ruby-identifier">colors</span> = <span class="ruby-identifier">colors</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">s</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span>} <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">colors</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">colors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">name</span> = <span class="ruby-constant">BBCOLOR2ANSI</span>[<span class="ruby-identifier">col</span>.<span class="ruby-identifier">downcase</span>]
            <span class="ruby-identifier">name</span> = <span class="ruby-constant">BBCOLOR2ANSI</span>[<span class="ruby-string">&quot;white&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">code</span> = <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-identifier">name</span>]

            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[COLOR=#{col}\]/</span>, <span class="ruby-identifier">code</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/COLOR\]/</span>, <span class="ruby-constant">ANSINAME2CODE</span>[<span class="ruby-string">&quot;reset&quot;</span>])

        <span class="ruby-comment">## TODO: Alignment</span>
        <span class="ruby-comment">## TODO: IMGs</span>
        <span class="ruby-comment">## TODO: EMAILs</span>
        <span class="ruby-comment">## TODO: URLs</span>
        <span class="ruby-comment">## TODO: QUOTEs</span>
        <span class="ruby-comment">## TODO: LISTs</span>

        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%s\n&quot;</span>, <span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="bbcode_to_html-method" class="method-detail ">
        <a name="method-c-bbcode_to_html"></a>

        <div class="method-heading">
        
          <span class="method-name">bbcode_to_html</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Converts a <a href="BBCode.html">BBCode</a> string to one with HTML markup.
Returns the string with all formatting instructions in BBCodes converted to
XHTML markups.</p>
          

          
          <div class="method-source-code"
            id="bbcode_to_html-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 253</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_html</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">quote</span> = <span class="ruby-value">0</span>

    <span class="ruby-comment">## Iterate over lines</span>
    <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">styles</span> = { <span class="ruby-string">&quot;b&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;strong&quot;</span>, <span class="ruby-string">&quot;i&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;em&quot;</span>, <span class="ruby-string">&quot;u&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;u&quot;</span> }

        <span class="ruby-comment">## preserve B, I, U</span>
        <span class="ruby-identifier">styles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">code</span>,<span class="ruby-identifier">html</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[#{code}\]/</span>, <span class="ruby-node">&quot;&lt;#{html}&gt;&quot;</span>)
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/\[\/#{code}\]/</span>, <span class="ruby-node">&quot;&lt;/#{html}&gt;&quot;</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">## COLOR =&gt; font color=... (TODO: should be numeric!)</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[COLOR=(.*?)\]/</span>, <span class="ruby-string">&quot;&lt;font color=\&quot;\\1\&quot;&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/COLOR\]/</span>,     <span class="ruby-string">&quot;&lt;/font&gt;&quot;</span>)

        <span class="ruby-comment">## SIZE =&gt; font size=...</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[SIZE=(.*?)\]/</span>, <span class="ruby-string">&quot;&lt;font size=\&quot;\\1\&quot;&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/SIZE\]/</span>,     <span class="ruby-string">&quot;&lt;/font&gt;&quot;</span>)

        <span class="ruby-comment">## URL</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[URL\]([^\[]+?)\[\/URL\]/</span>, <span class="ruby-string">&quot;&lt;a href=\&quot;\\1\&quot;&gt;\\1&lt;/a&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[URL=(.*?)\](.+?)\[\/URL\]/</span>, <span class="ruby-string">&quot;&lt;a href=\&quot;\\1\&quot;&gt;\\2&lt;/a&gt;&quot;</span>)

        <span class="ruby-comment">## IMG</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[IMG=(.*?)\]/</span>, <span class="ruby-string">&quot;&lt;img src=\&quot;\\1\&quot; /&gt;&quot;</span>)

        <span class="ruby-comment">## ALIGN=center (TODO: right, left)</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[ALIGN=center\]/</span>, <span class="ruby-string">&quot;&lt;center&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[ALIGN=right\]/</span>,  <span class="ruby-string">&quot;&lt;center&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[ALIGN=left\]/</span>,   <span class="ruby-string">&quot;&lt;center&gt;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/ALIGN\]/</span>,      <span class="ruby-string">&quot;&lt;/center&gt;&quot;</span>)

        <span class="ruby-comment">## QUOTE</span>
        <span class="ruby-identifier">quote</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\[QUOTE\]/</span>
        <span class="ruby-identifier">quote</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\[\/QUOTE\]/</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">quote</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[QUOTE\]/</span>,   <span class="ruby-string">&quot;&lt;pre&gt;\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/QUOTE\]/</span>, <span class="ruby-string">&quot;&lt;/pre&gt;\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/^/</span>, <span class="ruby-node">&quot;&amp;#62;&quot;</span>*<span class="ruby-identifier">quote</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">quote</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

        <span class="ruby-comment">## EMAIL</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[EMAIL\](.*?)\[\/EMAIL\]/</span>, <span class="ruby-string">&quot;&lt;a href=\&quot;mailto:\\1\&quot;&gt;\\1&lt;/a&gt;&quot;</span>)

        <span class="ruby-comment">## LIST (TODO: LIST=1, LIST=A)</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[LIST(?:=(.*?))?\]/</span>, <span class="ruby-string">&quot;\n&lt;ul&gt;\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\/LIST\]/</span>,          <span class="ruby-string">&quot;\n&lt;/ul&gt;\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\[\*\]/</span>,              <span class="ruby-string">&quot;\n&lt;li /&gt;&quot;</span>)

        <span class="ruby-comment">## FONT =&gt; font ??????</span>
        <span class="ruby-comment">## ?BLUR?, FADE?</span>

        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%s&lt;br /&gt;\n&quot;</span>, <span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="html_to_ansi-method" class="method-detail ">
        <a name="method-c-html_to_ansi"></a>

        <div class="method-heading">
        
          <span class="method-name">html_to_ansi</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Returns the (X)HTML markup code as <a href="../ANSI.html">ANSI</a>
sequences</p>
          

          
          <div class="method-source-code"
            id="html_to_ansi-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 326</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_ansi</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-identifier">bbcoded</span> = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_bbcode</span>(<span class="ruby-identifier">string</span> )
    <span class="ruby-identifier">ansied</span>  = <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">bbcode_to_ansi</span>(<span class="ruby-identifier">bbcoded</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ansied</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="html_to_bbcode-method" class="method-detail ">
        <a name="method-c-html_to_bbcode"></a>

        <div class="method-heading">
        
          <span class="method-name">html_to_bbcode</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>Converts a HTML string into one with <a href="BBCode.html">BBCode</a>
markup (TODO) Returns the (X)HTML markup string as <a
href="BBCode.html">BBCode</a></p>
          

          
          <div class="method-source-code"
            id="html_to_bbcode-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">html_to_bbcode</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-comment">## Iterate over lines</span>
    <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/&lt;br *\/?&gt;/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">styles</span> = { <span class="ruby-string">&quot;strong&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;b&quot;</span>, <span class="ruby-string">&quot;b&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;b&quot;</span>,
                    <span class="ruby-string">&quot;em&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;i&quot;</span>, <span class="ruby-string">&quot;i&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;i&quot;</span>,
                    <span class="ruby-string">&quot;u&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;u&quot;</span> }

        <span class="ruby-comment">## preserve B, I, U</span>
        <span class="ruby-identifier">styles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">html</span>,<span class="ruby-identifier">code</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/&lt;#{html}&gt;/</span>, <span class="ruby-node">&quot;[#{code.upcase}]&quot;</span>)
            <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/&lt;\/#{html}&gt;/</span>, <span class="ruby-node">&quot;[/#{code.upcase}]&quot;</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">## TODO: COLORs</span>
        <span class="ruby-comment">## TODO: SIZEs</span>
        <span class="ruby-comment">## TODO: FONTs</span>

        <span class="ruby-comment">## EMAIL</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;a +href *= *\&quot;mailto:(.*?)\&quot;.*?&gt;.*?&lt;\/a&gt;/</span>, <span class="ruby-string">&quot;[EMAIL]\\1[/EMAIL]&quot;</span>)

        <span class="ruby-comment">## URL</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;a +href *= *\&quot;((?:https?|ftp):\/\/.*?)\&quot;.*?&gt;(.*?)&lt;\/a&gt;/</span>, <span class="ruby-string">&quot;[URL=\\1]\\2[/URL]&quot;</span>)

        <span class="ruby-comment">## Other refs + closing tags =&gt; throw away</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;a +href *= *\&quot;.*?\&quot;.*?&gt;/</span>, <span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;\/a&gt;/</span>,            <span class="ruby-string">&quot;&quot;</span>)

        <span class="ruby-comment">## IMG</span>
        <span class="ruby-comment">#line.gsub!(/&lt;img +src *= *\&quot;(.*?)\&quot;.*?\/?&gt;/i, &quot;[IMG=\\1]&quot;)</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;img +src *= *\&quot;(.*?)\&quot;.*?\/?&gt;/</span>, <span class="ruby-string">&quot;[IMG]\\1[/IMG]&quot;</span>)

        <span class="ruby-comment">## CENTER (right/left??)</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;center&gt;/</span>,   <span class="ruby-string">&quot;[ALIGN=center]&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;\/center&gt;/</span>, <span class="ruby-string">&quot;[/ALIGN]&quot;</span>)

        <span class="ruby-comment">## QUOTE</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;(?:xmp|pre)&gt;/</span>,   <span class="ruby-string">&quot;[QUOTE]&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;\/(?:xmp|pre)&gt;/</span>, <span class="ruby-string">&quot;[/QUOTE]&quot;</span>)

        <span class="ruby-comment">## LIST</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;ul&gt;/</span>,      <span class="ruby-string">&quot;\n[LIST]\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;\/ul&gt;/</span>,    <span class="ruby-string">&quot;\n[/LIST]\n&quot;</span>)
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;li *\/?&gt; */</span>, <span class="ruby-string">&quot;\n[*] &quot;</span>)

        <span class="ruby-comment">## Unkown tags =&gt; throw away</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;.*? *\/?&gt;/</span>, <span class="ruby-string">&quot;&quot;</span>)

        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%s&lt;br /&gt;\n&quot;</span>, <span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/&lt;br *\/?&gt;/</span>, <span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="strip_bbcode-method" class="method-detail ">
        <a name="method-c-strip_bbcode"></a>

        <div class="method-heading">
        
          <span class="method-name">strip_bbcode</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>— <a href="BBCode.html#method-c-strip_bbcode">strip_bbcode</a>( string )
Will strip any <a href="BBCode.html">BBCode</a> tags from the given string.</p>
          

          
          <div class="method-source-code"
            id="strip_bbcode-source">
<pre>
<span class="ruby-comment"># File lib/ansi/bbcode.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">BBCode</span>.<span class="ruby-identifier">strip_bbcode</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-identifier">string</span>.<span class="ruby-identifier">strip!</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\[[A-Za-z0-9\/=]+\]/</span>, <span class="ruby-string">&quot;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  

  </div>


  <div id="rdoc-debugging-section-dump" class="debugging-section">
  
    <p>Disabled; run with --debug to generate this.</p>
  
  </div>

</main>
</body>
</html>

